<!DOCTYPE html>
<html>
    <head>
        <title>{$arr['webname']['info_value']}</title>
        {:W('Public/_meta')}
        <meta name=GENERATOR content="MShtml 8.00.7601.17514">
        <meta name="keywords" />
        <link href="__PUBLIC__/images/favicon.ico" type="image/x-icon" rel="shortcut icon" />
        <link rel="stylesheet" type="text/css" href="__HOME_CSS__/device_env.css">
        <link rel="stylesheet" type="text/css" href="__HOME_CSS__/device_search.css">
        <link rel="stylesheet" type="text/css" href="__HOME_CSS__/pagination.css" />
       
</head>
<style>
    .button-gray{
        border: solid 1px #555;
        float:right;
        background-color: #2275D3;
        font: 14px/100% Arial, Helvetica, sans-serif;
        /*line-height: 100%;*/
        padding: .5em 1em .55em;
        border-radius: .5em;
    }
    .button-gray a{
        color:#fff;
    } 
</style>
<body>
    <div id=loading style="position:absolute;width:100%;z-index:9999">
            {:W('Header/loading')}
        </div>
   {:W('Header/device_header')}
    
    <div class="pest-wrap">
        <div class="pest_middle" id='pest_middle'>
            <div class="middle_center">
                <div class="center_top">

                    <div class="center_top_info cl">
                        <div class="LeftBotton" onmousedown="ISL_GoUp()" onmouseup="ISL_StopUp()" onmouseout="ISL_StopUp()"></div>
                        <div class="Cont" id="ISL_Cont">
                            <div class="ScrCont">
                                <div id="List1">
                                    <!-- 图片列表 begin -->
                                    <div class="pic">
                                        <div id="circle">

                                            <img alt="光照强度" src="__HOME_IMG__/device_env/env-gz.png" />
                                            <span>
                                                <p>光照强度<br/><empty name="env['beam']">暂无数据<else />{$env['beam']}</empty></p> 
                                            </span>
                                        </div>
                                    </div>
                                    <div class="pic">
                                        <div id="circle">

                                            <img alt="当前风向" src="__HOME_IMG__/device_env/env-fx.png" />
                                            <span>
                                                <p>当前风向<br/><empty name="env['wind_direction']">暂无数据<else />{$env['wind_direction']}</empty></p> 
                                            </span>
                                        </div>
                                    </div>
                                    <div class="pic">
                                        <div id="circle">

                                            <img alt="空气湿度" src="__HOME_IMG__/device_env/env-sd.png" />
                                            <span>
                                                <p>空气湿度<br/><empty name="env['humidity']">暂无数据<else />{$env['humidity']}%</empty></p> 
                                            </span>
                                        </div>
                                    </div>
                                    <div class="pic">
                                        <div id="circle">

                                            <img alt="当前温度" src="__HOME_IMG__/device_env/env-wd.png" />
                                            <span>
                                                <p>当前温度<br/><empty name="env['temp']">暂无数据<else />{$env['temp']}℃</empty></p> 
                                            </span>
                                        </div>
                                    </div>
                                    <div class="pic">
                                        <div id="circle">

                                            <img alt="当前风力" src="__HOME_IMG__/device_env/env-fl.png" />
                                            <span>
                                                <p>当前风力<br/><empty name="env['wind_speed']">暂无数据<else />{$env['wind_speed']}</empty></p> 
                                            </span>
                                        </div>
                                    </div>
                                    <!-- 图片列表 end -->
                                </div>
                                <div id="List2"></div>
                            </div>
                        </div>
                        <div class="RightBotton" onmousedown="ISL_GoDown()" onmouseup="ISL_StopDown()" onmouseout="ISL_StopDown()"></div>
                        <div class="cl"></div>
                    </div>
                    <div class="cl"></div>
                </div>
                <div class="cl"></div>
                <div class="center_bottom">
                    <div id="tab_demo" class="HuiTab">
                        <div class="tabBar clearfix"><span>按列表查看</span><span>按图表查看</span></div>
                        <div class="tabCon">
                            <div class="center_bottom_search">
                                <form id="envList">
                                    <div style="font-size: 15px;" class="row cl">
                                        <!--<span style="margin-right: 10px;color: #090">区域:<span>{$region}</span></span>-->
                                        日期范围：
                                        <input type="text" name='statrTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', maxDate:'#F{$dp.$D(\'listLogmax\')||\'%y-%M-%d %H:%m:%s\'}' })"</literal> id="listLogmin" class="input-text Wdate" style="width:150px;"> -
                                        <input type="text" name='endTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'listLogmin\')}',maxDate:'%y-%M-%d %H:%m:%s' })"</literal> id="listLogmax" class="input-text Wdate" style="width:150px;">
                                            <span id="listSumData" class="pmr">
                                                    汇总周期：
                                                    <span class="button1 white active" style="width:42px;">不汇总</span>
                                                    <span class="button1 white" style="margin-left:-5px;width:30px;" id="hours">小时</span>
                                                    <span class="button1 white" style="margin-left:-5px" id="tian">天</span>
                                                    <span class="button1 white" style="margin-left:-5px" id="zhou">周</span>
                                                    <span class="button1 white" style="margin-left:-5px" id="yue">月</span>
                                                    <span class="button1 white" style="margin-left:-5px" id="nian">年</span>
                                        </span>
                                        <button type="button" name="envList" class="button green" style="color: #fff;margin-left:25px;">执行</button>
                                        <!--<button type="button"  name="envExcel" id="excelbutton" class=" button gray" style="color: #fff;">导出</button>-->
                                        <button type="reset" class="button blue" style="color: #fff;">重置</button>
                                    </div>
                                </form>
                            </div>
                            <div class="center_bottom_table">
                                <table id="example"  class="table table-border table-bordered table-bg table-hover table-sort ">
                                    <thead class="text-c">
                                        <tr>
                                            <th>设备号</th>
                                            <th>温度℃</th>
                                            <th>湿度%</th>
                                            <th>风力m/s</th>
                                            <th>风向</th>
                                            <th>光照lux</th>
                                            <th width="150">开始时间</th>
                                            <th width="150">结束时间</th>
                                            <th width="150">创建时间</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                                <div class="cl"></div>
                            </div>
                        </div>
                        <div class="tabCon">
                            <div class="center_bottom_search">
                                <form>
                                    <div style="font-size: 15px;" class="row cl">
                        <!--<span style="margin-right: 10px;color: #090">区域:<span>{$deviceData['de_region']}</span></span>-->
                        

                                        日期范围：
                                        <input autocomplete="off" type="text" name='statrTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', maxDate:'#F{$dp.$D(\'chartsLogmax\')||\'%y-%M-%d %H:%m:%s\'}' })"</literal> id="chartsLogmin" class="input-text Wdate" style="width:150px;"> -
                                        <input autocomplete="off" type="text" name='endTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'chartsLogmin\')}',maxDate:'%y-%M-%d %H:%m:%s' })"</literal> id="chartsLogmax" class="input-text Wdate" style="width:150px;">
<!--                                        <span id="charsSumData" class="pmr">
                                            汇总周期：
                                            <span class="button1 white active" style="width:42px;">不汇总</span>
                                            <span class="button1 white" style="margin-left:-5px;width:30px;" id="hours">小时</span>
                                            <span class="button1 white" style="margin-left:-5px" id="tian">天</span>
                                            <span class="button1 white" style="margin-left:-5px" id="zhou">周</span>
                                            <span class="button1 white" style="margin-left:-5px" id="yue">月</span>
                                            <span class="button1 white" style="margin-left:-5px" id="nian">年</span>
                                        </span>-->
                                        <button type="button" id="envChartsButton" name="envCharts" class="button green" style="color: #fff;margin-left:25px;">执行</button>
                                        <button type="reset" id="envChartsResetButton" class=" button blue" style="color: #fff;">重置</button>
                                    </div>
                                </form>
                            </div>
                            <div style="margin-top:15px">
                                <span style="font-size:17px;">日气象趋势图</span>
<!--                                    <br/>-->
                                <span style="margin-left:40px;color:red" class="pmr">区域:{$rnname['rnname']} </span>
                                <!--<span class="pmr" >监测周期：2017.05.20至2017.05.24 </span>-->
                            </div>

                            <div id="content" style="width:1200px;height:460px;margin-top: 30px;">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
     {:W('Header/footer')}
</body>
{:W('Public/_footer')}
<script type="text/javascript" src="__PUBLIC_STATIC__/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="__PUBLIC_STATIC__/datatables/Buttons-1.3.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="__PUBLIC_STATIC__/datatables/Buttons-1.3.1/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="__PUBLIC_STATIC__/datatables/jszip/jszip.min.js"></script>
<script type="text/javascript" src="__PUBLIC_STATIC__/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__HOME_JS__/device.js"></script>
 <script type="text/javascript" src="__HOME_JS__/echarts.js"></script>

<script>
    $(function () {
        $('#envChartsButton').click(function () {
             var myChart = echarts.init(document.getElementById('content'));
               myChart.showLoading({
                        text : '数据量较大\n拼命刷新中',
                        effect : 'bubble',
                        textStyle : {
                            fontSize : 30
                        }
                    });
            $.ajax({
                type: "post",
                url: "{:U('Device/envCharts')}",
                data: {
                    "startTime": $("#chartsLogmin").val(),
                    "endTime": $("#chartsLogmax").val(),
                },
                success: function (data) {
                   
                     if("" == data){
                            document.getElementById('content').innerHTML = "<div class='va-m' style='font-size:24px;text-align:center;'>暂无数据</div>";
                        }else{
                            envCharts(data,myChart);
                        }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                     document.getElementById('content').innerHTML = "<div class='va-m' style='font-size:24px;text-align:center;'>请求出错，请联系技术</div>";
                    
                }
            });
        });
        $('#envChartsButton').click();
    });
</script>
<script type="text/javascript">
function envCharts(data,myChart) {
    var addtime = data.addtime.map(function (str) {
        return str.replace(' ', '\n');
    });
    option = {
  
        tooltip: {
            trigger: 'axis',
            axisPointer: { // 坐标轴指示器，坐标轴触发有效
                type: 'cross' // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {
            data: ['温度', '湿度', '光照', '风力'],
            selected: {
                '温度': true,
                '湿度': true,
                '光照': true,
                '风力': true,
            }
        },
        grid: {
            y2: 140,
            x:80,
            x2:110,
            top:100,
        },
        toolbox: {
            itemSize:20,
           showTile:true,
            feature: {
                dataView: {
                    show: true,
                    readOnly: false
                },
                restore: {
                    show: true
                },
                saveAsImage: {
                    show: true
                }
            },
             top:0,
           right:30,
            
        },
         dataZoom: [{
                show: true,
                realtime: true,
                start: 0,
                end: 100,


            }, {
                type: 'inside',
                realtime: true,
                start: 0,
                end: 100,

            }],
        xAxis: [{
                type: 'category',
                axisTick: {
                    alignWithLabel: true
                },
                boundaryGap : true,
                axisLine: {onZero: false},
                data: addtime,
        }],
        yAxis: [{
                    type: 'value',
                    name: '温度(℃)',

                    position: 'left',
                    axisLabel: {},
                    splitLine: {
                        show: false
                    }
                },
                {
                    type: 'value',
                    name: '湿度(%)',

                    position: 'left',
                    offset: 45,
                    axisLabel: {}
                },
                {
                    type: 'value',
                    name: '光照(lux)',

                    position: 'right',
                    offset: 55,
                    axisLabel: {},
                },
                {
                    type: 'value',
                    name: '风力(m/s)',

                    position: 'right',
                    axisLabel: {},
                },
        ],
        series: [
            {
                name: '温度',
                type: 'line',
                symbolSize: 8,
                smooth:true, 
                hoverAnimation: false,
                data: data.temp
            },
            {
                name: '湿度',
                type: 'line',
                yAxisIndex: 1,
                smooth:true, 
                data: data.humidity
            },
            {
                name: '光照',
                type: 'line',
                yAxisIndex: 2,
                smooth:true, 
                data: data.beam
            },
            {
                name: '风力',
                type: 'line',
                smooth:true, 
                yAxisIndex: 3,
                data: data.wind_speed
            },
        ]
    };
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
    myChart.hideLoading();
}
</script>
<script>
    var envList;
    $("button[name='envList']").bind("click", function () { //按钮 触发table重新请求服务器     
        envList.draw();
    });
    $(function () {
        $.Huitab("#tab_demo .tabBar span", "#tab_demo .tabCon", "current", "click", "0");
        
        envList = $('#example').DataTable({
            dom: 'lr<"button-gray"B>tip',
        buttons: [ 
                
                {  
                    text: '导出EXCEL',
            extend: 'excelHtml5',
            customize: function( xlsx ) {
                var sheet = xlsx.xl.worksheets['sheet1.xml'];
 
                $('row c[r^="C"]', sheet).attr( 's', '2' );
            },
            
           
        } ,
        
    ],
            "language": {
                "lengthMenu": "每页 _MENU_ 条记录",
                "zeroRecords": "没有找到记录",
                "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                "infoEmpty": "无记录",
                "infoFiltered": "(从 _MAX_ 条记录过滤)",
                "processing": "正在处理中...",
                "paginate": {

                    "previous": "上一页",
                    "next": "下一页",
                  }
            },
            "bFilter": false, //过滤功能
            "bSort": false, //排序功能
            "bAutoWidth": true, //自动宽度
            "bStateSave": false, //状态保存
            serverSide: true, //服务器模式
            "processing": true,
            ajax: {
                url: "{:U('Device/envList')}",
                type: 'POST',
                data: function (d) {
                    d.listSumData = $("#listSumData").children(".active").attr("id");
                    d.startTime = $("#listLogmin").val();
                    d.endTime = $("#listLogmax").val();
                },
            },
               
            "aoColumns": [//这个属性下的设置会应用到所有列，按顺序没有是空
                    {
                       "sClass": "text-c",
                       "mData": "device_code",
                   },
                {
                    "sClass": "text-c",
                    "data": "temp",
                    "render": function (data, type, full, meta) {
                        if (data == "-" || data == "" || data == null) {
                            return "-";
                        } else {
                            return data;
                        }
                    }
                },
                {
                    "sClass": "text-c",
                    "mData": 'humidity',
                    "render": function (data, type, full, meta) {
                        if (data == "-" || data == "" || data == null) {
                            return "-";
                        } else {
                            return data;
                        }
                    }
                },

                {
                    "sClass": "text-c",
                    "mData": 'wind_speed',
                    "render": function (data, type, full, meta) {
                        if (data == "-" || data == "" || data == null) {
                            return "-";
                        } else {
                            return data;
                        }
                    }
                },
                {
                    "sClass": "text-c",
                    "mData": 'wind_direction',
                    "render": function (data, type, full, meta) {
                        if (data == "-" || data == "" || data == null) {
                            return "-";
                        } else {
                            return data;
                        }
                    }
                },
                {
                    "sClass": "text-c",
                    "mData": 'beam',
                    "render": function (data, type, full, meta) {
                        if (data == "-" || data == "" || data == null) {
                            return "-";
                        } else {
                            return data;
                        }
                    }
                },
                

                {
                    "sClass": "text-c",
                    "mData": 'unix_starttime',
                    "render": function (data, type, full, meta) {

                        if (0 == data) {
                            return "-";
                        } else {
                            var newDate = new Date(data);
                            newDate.setTime(data * 1000);
                            return formatDate(newDate);
                        }
                    }
                },
                {
                    "sClass": "text-c",
                    "mData": 'unix_endtime',
                    "render": function (data, type, full, meta) {

                        if ( 0 == data ) {
                            return "-";
                        } else {
                            var newDate = new Date(data);
                            newDate.setTime(data * 1000);
                            return formatDate(newDate);
                        }
                    }
                },
               
//                {
//                    "sClass": "text-c",
//                    "mData": 'unix_addtime',
//                    "render": function (data, type, full, meta) {
//                        if (0 == data) {
//                            return "-";
//                        } else {
//                            var newDate = new Date(data);
//                            newDate.setTime(data * 1000);
//                            return formatDate(newDate);
//                        }
//                    }
//                },
                {
                    "sClass": "text-c",
                    "mData": 'unix_createdate',
                    "render": function (data, type, full, meta) {
                        if (0 == data) {
                            return "-";
                        } else {
                            var newDate = new Date(data);
                            newDate.setTime(data * 1000);
                            return formatDate(newDate);
                        }
                    }
                },
            ],
        });

    });
   $(window).on("scroll",backToTopFun);
	backToTopFun()
    $("#listSumData span").click(function () {
        $('#listSumData span').removeClass("active");
        $(this).addClass("active");
    });
    $("#charsSumData span").click(function () {
        $('#charsSumData span').removeClass("active");
        $(this).addClass("active");
    })
</script>
<script>
    window.onload = setTimeout( function(){
        $("#loading").hide();
    },1);
</script>

</html>