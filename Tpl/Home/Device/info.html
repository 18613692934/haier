<!DOCTYPE HTML>
<html>
<head>

 {:W('Public/_meta')}
<link rel="stylesheet" type="text/css" href="__HOME_CSS__/device_info.css">

<title>{$arr['webname']['info_value']}</title>
<style>
.history_list .odd{height:250px;width:241px; float: left;min-height: 1px;position: relative;  box-sizing:border-box;}
.history_list .even{height:250px;width:241px; float: left;min-height: 1px;position: relative;  box-sizing:border-box;}
.history_list .table-history{border:0}
.history_list .form{
    padding:10px;
    background-color: #d8ecf3;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    border-radius: 5px;
}
.history_list .text-c{
    border:0;
    width:100%;
    height:100%;
    
}

.history_list  p{

    color: #5494dc;
    text-align: center;
       font-size:16px;
}

.history_list .table-border th, .history_list .table-border td {
    border:0;
}

</style>
</head>
<body>
   
    <div id=loading style="position:absolute;width:100%;z-index:9999">
        {:W('Header/loading')}
    </div>
    {:W('Header/device_header')}
    
    <div id="tab_demo" class="HuiTab" style="margin-top:20px;">
        <div class="tabBar clearfix">
            <span>苗情图片</span>
            <span>虫害图片</span></div>
        <!--苗情图片开始-->
            <div class="tabCon">
                                    <section class="Hui-article-box">
                                    <div class="Hui-article">
                                        <article class="cl pd-20">

                                            <div class="bk-gray  radius  pd-10">
                                                <div class="bk-gray  radius  pd-10 mt-5">
                                                    <form>
                                                        <div class="row cl">
                                                            <div class="col-sm-3">
                                                                <label>开始时间</label>
                                    <input autocomplete="off" type="text" name='startTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', maxDate:'#F{$dp.$D(\'diseaseInfoLogmax\')||\'%y-%M-%d %H:%m:%s\'}' })"</literal> id="diseaseInfoLogmin" class="input-text Wdate" style="width:150px;">
                                                            </div>
                                                            <div class="col-sm-3">
                                                                <label>结束时间</label>
                                    <input autocomplete="off" type="text" name='endTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'diseaseInfoLogmin\')}',maxDate:'%y-%M-%d %H:%m:%s' })"</literal> id="diseaseInfoLogmax" class="input-text Wdate" style="width:150px;">
                                                            </div>

                                                            <div class="col-sm-3">
                                                                <button type="button" name="infoDisease"  class="btn btn-primary radius" style="margin-left:25px;">执行</button>

                                                                <button type="reset"   class="btn btn-warning radius">重置</button>
                                                            </div>
                                                        </div>
                                                        <div class="row cl">
                                                        </div>
                                                    </form> 
                                                </div>
                                                    
                                                    <div class="bk-gray  radius  pd-10 mt-10 cl history_list va-m ">
                                                        <table  class="table table-border table-bordered table-bg table-hover table-disease "> 
                                                            <thead></thead>
                                                        </table>
                                                    </div>
                                                
                                                
                                            </div>
                                        </article>
                                    </div>
                                </section>
                                </div>
        <!--苗情图片结束-->
        <!--虫害图片开始-->
        <div class="tabCon">
            <section class="Hui-article-box">
                <div class="Hui-article">
                    <article class="cl pd-20">

                        <div class="bk-gray  radius  pd-10">
                            <div style="font-size:20px;text-align: center">大蒜越冬期及生长期暂无虫害数据</div>
<!--                                                <div class="bk-gray  radius  pd-10 mt-5">
                                                    <form>
                                                        <div class="row cl">
                                                            <div class="col-sm-3">
                                                                <label>开始时间</label>
                                    <input autocomplete="off" type="text" name='startTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', maxDate:'#F{$dp.$D(\'pestinfoLogmax\')||\'%y-%M-%d %H:%m:%s\'}' })"</literal> id="pestinfoLogmin" class="input-text Wdate" style="width:150px;">
                                                            </div>
                                                            <div class="col-sm-3">
                                                                <label>结束时间</label>
                                    <input autocomplete="off" type="text" name='endTime' onfocus=<literal>"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'pestinfoLogmin\')}',maxDate:'%y-%M-%d %H:%m:%s' })"</literal> id="pestinfoLogmax" class="input-text Wdate" style="width:150px;">
                                                            </div>

                                                            <div class="col-sm-3">
                                                                <button type="button" name="infoPest"  class="btn btn-primary radius" style="margin-left:25px;">执行</button>

                                                                <button type="reset"   class="btn btn-warning radius">重置</button>
                                                            </div>
                                                        </div>
                                                        <div class="row cl">
                                                        </div>
                                                    </form> 
                                                </div>
                                                    
                                                    <div class="bk-gray  radius  pd-10 mt-10 cl history_list va-m ">
                                                        <table  class="table table-border table-bordered table-bg table-hover table-history "> 
                                                            <thead></thead>
                                                        </table>
                                                    </div>-->
                           
                            
                       
                            
                            

                        </div>
                    </article>
                    
                </div>
            </section>
            
           
            
</div>
        <!--虫害图片结束-->
</div>

 {:W('Header/footer')}
</body>
 {:W('Public/_footer')}
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__PUBLIC_STATIC__/My97DatePicker/4.8/WdatePicker.js"></script> 
<script type="text/javascript" src="__PUBLIC_STATIC__/datatables/1.10.0/jquery.dataTables.min.js"></script> 
<script>
         function picture_edit(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url,
               maxmin: true, //开启最大化最小化按钮
                shadeClose: true,
                area: ['80%', '95%'],
	});
        
}
        
    </script>
    <script type="text/javascript">
    



        $(function() {
            var infoDisease;
            $("button[name='infoDisease']").bind("click", function () { //按钮 触发table重新请求服务器     
             infoDisease.fnDraw();
             });
             
            infoDisease = $('.table-disease').dataTable({
                "language": {
                    "lengthMenu": "每页 _MENU_ 条记录",
                    "zeroRecords": "没有找到记录",
                    "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                    "infoEmpty": "无记录",
                    "infoFiltered": "(从 _MAX_ 条记录过滤)",
                    "processing": "正在处理中...",
                    "paginate": {
                        "previous": "上一页",
                        "next": "下一页",
                    }
                },
                "bFilter": false, //过滤功能
                "bSort": false, //排序功能
                "bAutoWidth": false,//自动宽度
            "aLengthMenu": [[15, 20,30,40], [15, 20,30,40]],
            "aaSorting": [[ 0, "desc" ]],//默认第几个排序
            "bStateSave": false,//状态保存
            serverSide: true,
            ajax: {
                url: "{:U('Device/infoDisease')}",
                type: 'POST',
                data:function(d){
                    d.startTime = $("#diseaseInfoLogmin").val();
                    d.endTime = $("#diseaseInfoLogmax").val();
                },
            },
            "aoColumnDefs": [
              //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
              // {"orderable":false,"aTargets":[0]}// 不参与排序的列
            ],
             "aoColumns": [ //这个属性下的设置会应用到所有列，按顺序没有是空
            {
                "sClass": "text-c",   
                "data": {
                    "de_id":"de_id",
                    "createdate":"unix_addtime",
                    " image":"image", 
                },
                "render":function(data,type,full,meta){
                    
                    var newDate = new Date(data.unix_addtime);
                    newDate.setTime(data.unix_addtime*1000);
                    var createdate = formatDate(newDate);

//                    if(data.file_exists){
                        var str = "<div id='item-pdid4' class='list_wrap cl'>"+
                        "<div class='row cl'>"+
                        "<div class='col-xs-12'>"+
                          "<p>"+createdate+"</p>"+                        
                        "<a onclick=picture_edit('图片查看','{:U(\'Device/diseaseImgShow\',array(\'id\'=>deid1))}') href=javascript:;>"+
                            "<img style='width:225px;height:187px'  src='"+data.image+"' alt='苗情图片' />"+
                        "</a>"+
                        "<p>点击图片，人工校验</p>"+                        
                        "</div>"+
                        "</div>"+
                       
                    "</div>";
//                 
                    str = str.replace("deid1",data.de_id); 
                    
//                    }
//                    else{
//                        var str = 
//                         "<div class='text-c f-18 mb-10'>图片丢失</div>"+
//                         "<div class='text-c f-16'>[<a onclick=imgDel(deid1) href=javascript:;>删除此数据</a>] | 忽略本提示</div>";
//
//                    str = str.replace("deid1",data.de_id); 
//                    
//                    }
                    
                    return str; 
                }
             }, //mData 表示发请求时候本列的列明，返回的数据中相同下标名字的数据会填充到这一列
            
             ]
            });
        });
        
</script>
<script type="text/javascript">

        $(function() {
            var infoPest;
            $("button[name='infoPest']").bind("click", function () { //按钮 触发table重新请求服务器     
             infoPest.fnDraw();
             });
            $.Huitab("#tab_demo .tabBar span", "#tab_demo .tabCon", "current", "click", "0");
            infoPest = $('.table-history').dataTable({
                "language": {
                    "lengthMenu": "每页 _MENU_ 条记录",
                    "zeroRecords": "没有找到记录",
                    "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                    "infoEmpty": "无记录",
                    "infoFiltered": "(从 _MAX_ 条记录过滤)",
                    "processing": "正在处理中...",
                    "paginate": {
                        "previous": "上一页",
                        "next": "下一页",
                    }
                },
                "bFilter": false, //过滤功能
                "bSort": false, //排序功能
                "bAutoWidth": false,//自动宽度
            "aLengthMenu": [[15, 20,30,40], [15, 20,30,40]],
            "aaSorting": [[ 0, "desc" ]],//默认第几个排序
            "bStateSave": false,//状态保存
            serverSide: true,
            ajax: {
                url: "{:U('Device/infoPest')}",
                type: 'POST',
                data:function(d){
                    d.startTime = $("#pestinfoLogmin").val();
                    d.endTime = $("#pestinfoLogmax").val();
                },
            },
            "aoColumnDefs": [
              //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
              // {"orderable":false,"aTargets":[0]}// 不参与排序的列
            ],
             "aoColumns": [ //这个属性下的设置会应用到所有列，按顺序没有是空
            {
                "sClass": "text-c",   
                "data": {
                    "pd_id":"pd_id",
                    "createdate":"unix_createdate",
                    " image":"thum_image",
                    "baie_num":"baie_num", 
                },
                "render":function(data,type,full,meta){
                    
                    var newDate = new Date(data.unix_createdate);
                    newDate.setTime(data.unix_createdate*1000);
                    var createdate = formatDate(newDate);
                    if(data.file_exists){
                        var str = "<div id='item-pdid4' class='list_wrap cl'>"+
                        "<div class='row cl'>"+
                        "<div class='col-xs-12'>"+
                          "<p>"+createdate+"</p>"+                        
                        "<a onclick=picture_edit('图片查看','{:U(\'Device/infoImgShow\',array(\'id\'=>pdid1))}') href=javascript:;>"+
                            "<img  src='"+data.thum_image+"' alt='虫害图片' />"+
                        "</a>"+
                        "<p>点击图片，人工校验</p>"+                        
                        "</div>"+
                        "</div>"+
                       
                    "</div>";
//                 
                    str = str.replace("pdid1",data.pd_id); 
                    
                    }else{
                        var str = 
                         "<div class='text-c f-18 mb-10'>图片丢失</div>"+
                         "<div class='text-c f-16'>[<a onclick=imgDel(pdid1) href=javascript:;>删除此数据</a>] | 忽略本提示</div>";

                    str = str.replace("pdid1",data.pd_id); 
                    
                    }
                    
                    return str; 
                }
             }, //mData 表示发请求时候本列的列明，返回的数据中相同下标名字的数据会填充到这一列
            
             ]
            });
        });
        
</script>
<script type="text/javascript">
    function picture_edit(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url,
               maxmin: true, //开启最大化最小化按钮
                shadeClose: true,
                area: ['80%', '95%'],
	});
        
}

function imgDel(id){
   
         var id = id;
	layer.confirm('确认要删除吗？',function(index){
		$.ajax({
			type: 'POST',
			url: "{:U('Device/infoPestImgDel')}",
			dataType: 'json',
                        data:{
                          "id":id,  
                        },
			success: function(data){
                            layer.msg(data.info,{icon:data.state,time:500});
                            $("button[name='infoPest']").click();
//                            setTimeout(function(){
//                                window.location.reload(location.href); //刷新
//                            },500);
			},
			error:function(data) {
				
			},
		});		
	});
}
</script>
<script>
        window.onload = setTimeout( function(){
            $("#loading").hide();
        },1);
    </script>
</html>
